## 2026-01-08: shadcn/ui Setup Complete

### What was done:
- Ran `bunx shadcn@latest init` to initialize shadcn/ui with Tailwind v4
- Configured components.json with new-york style, RSC support, lucide icons
- Added base components: button, card, input, label, form
- Updated home page to demonstrate components working
- Verified typecheck passes and components render correctly

### Files created/modified:
- src/lib/utils.ts (cn utility)
- components.json (shadcn config)
- src/app/globals.css (updated with shadcn CSS variables)
- src/components/ui/button.tsx
- src/components/ui/card.tsx
- src/components/ui/input.tsx
- src/components/ui/label.tsx
- src/components/ui/form.tsx
- src/app/page.tsx (demo using components)

### Dependencies added:
- clsx, tailwind-merge (via utils)
- @radix-ui/react-label, @radix-ui/react-slot
- class-variance-authority
- lucide-react
- react-hook-form, @hookform/resolvers
- tw-animate-css

### Next priority:
Configure Vitest for unit/integration testing (PRD item #2)

---

## 2026-01-08: Vitest Testing Setup Complete

### What was done:
- Installed vitest 4.x, @testing-library/react, @testing-library/jest-dom, @testing-library/user-event
- Created vitest.config.ts with jsdom environment, React plugin, path aliases
- Created vitest.setup.ts with jest-dom matchers
- Added test scripts to package.json (test, test:watch, test:coverage)
- Created sample Button component tests (6 tests covering variants, sizes, events, asChild)
- Verified tests pass via `bun run test`
- Verified typecheck passes

### Files created/modified:
- vitest.config.ts (vitest configuration)
- vitest.setup.ts (jest-dom setup)
- package.json (updated test scripts)
- src/components/ui/__tests__/button.test.tsx (sample tests)

### Dependencies added:
- vitest, @vitejs/plugin-react, jsdom
- @testing-library/react, @testing-library/dom, @testing-library/jest-dom, @testing-library/user-event

### Notes:
- Use `bun run test` to run tests (not `bun test` which is bun's native test runner)
- Tests use Vitest's globals (describe, it, expect, vi)
- jsdom environment configured for React component testing

### Next priority:
Configure Playwright for E2E testing (PRD item #3)

---

## 2026-01-08: Playwright E2E Testing Setup Complete

### What was done:
- Installed @playwright/test 1.57.0
- Installed Chromium browser for Playwright
- Created playwright.config.ts with Next.js webServer integration
- Added e2e test scripts to package.json (test:e2e, test:e2e:ui)
- Created sample E2E tests for home page (3 tests)
- Verified all E2E tests pass via `bun run test:e2e`
- Verified typecheck passes, unit tests pass

### Files created/modified:
- playwright.config.ts (Playwright configuration)
- e2e/home.spec.ts (sample E2E tests)
- package.json (added e2e scripts)

### Dependencies added:
- @playwright/test

### Notes:
- Use `bun run test:e2e` to run E2E tests
- Use `bun run test:e2e:ui` for interactive UI mode
- Config auto-starts dev server if not running
- Tests use Chromium only (can add Firefox/Safari later)
- HTML reporter generates to playwright-report/

### Next priority:
Configure test mocking infrastructure (PRD item #4)

---

## 2026-01-08: T3 Env Type-Safe Environment Variables Complete

### What was done:
- Installed @t3-oss/env-nextjs for type-safe env validation
- Created src/env.ts with server and client env schemas
- Defined all required env vars: DATABASE_URL, BETTER_AUTH_SECRET, SPOTIFY_CLIENT_ID, SPOTIFY_CLIENT_SECRET, NEXT_PUBLIC_APP_URL
- Added optional env vars: PUSHOVER_USER_KEY, PUSHOVER_API_TOKEN
- Added env validation import to next.config.ts
- Created .env.example with all variables documented
- Created .env.local for local development
- Updated .gitignore to commit .env.example but ignore .env.local
- Verified build fails on missing env vars, succeeds with valid env

### Files created/modified:
- src/env.ts (env validation schema)
- next.config.ts (imports env for build-time validation)
- .env.example (template for all env vars)
- .env.local (local development values)
- .gitignore (updated env file patterns)

### Dependencies added:
- @t3-oss/env-nextjs (zod already present)

### Notes:
- Import `env` from "@/env" to access type-safe env vars
- Build will fail if required env vars missing (unless SKIP_ENV_VALIDATION=1)
- Client-side vars must be prefixed with NEXT_PUBLIC_

### Next priority:
Configure test mocking infrastructure (PRD item #4)

---

## 2026-01-08: PostgreSQL with Docker and Drizzle ORM Complete

### What was done:
- Created docker-compose.yml with PostgreSQL 16 Alpine container
- Installed drizzle-orm, postgres (driver), and drizzle-kit
- Created full database schema with tables: users, game_sessions, players, turns, game_history
- Created db connection module exporting typed db instance
- Added drizzle.config.ts for drizzle-kit
- Added db scripts: db:push, db:studio, db:generate, db:migrate
- Verified schema pushes to database and all tables created

### Files created/modified:
- docker-compose.yml (PostgreSQL container config, port 5433)
- drizzle.config.ts (Drizzle Kit configuration)
- src/db/schema.ts (full schema with types)
- src/db/index.ts (database connection)
- package.json (db scripts added)
- .env.example, .env.local (updated DATABASE_URL with port 5433)

### Dependencies added:
- drizzle-orm, postgres
- drizzle-kit, dotenv (dev)

### Notes:
- Uses port 5433 to avoid conflicts with local postgres on 5432
- Run `docker compose up -d` to start postgres
- Run `bun run db:push` to push schema changes
- Run `bun run db:studio` for Drizzle Studio GUI
- Schema includes: game_state enum, foreign key relationships, JSONB for flexible data

### Next priority:
Configure tRPC with TanStack React Query for RSC (PRD item #6)

---

## 2026-01-08: tRPC with TanStack React Query for RSC Complete

### What was done:
- Installed @trpc/server, @trpc/client, @trpc/tanstack-react-query, @tanstack/react-query, server-only
- Created src/trpc/init.ts with createTRPCContext (cached), createTRPCRouter, createCallerFactory, baseProcedure
- Created src/trpc/routers/_app.ts with appRouter and sample procedures (healthcheck, hello)
- Created src/app/api/trpc/[trpc]/route.ts with fetchRequestHandler for GET/POST
- Created src/trpc/query-client.ts with makeQueryClient factory (staleTime, dehydrate options)
- Created src/trpc/client.tsx with TRPCProvider, useTRPC, TRPCReactProvider
- Created src/trpc/server.ts with trpc proxy, HydrateClient, getQueryClient for RSC
- Added TRPCReactProvider to app/layout.tsx
- Created sample Greeting component demonstrating client-side query usage
- Updated home page with RSC prefetching and HydrateClient
- Verified type-safe queries work end-to-end

### Files created/modified:
- src/trpc/init.ts (tRPC initialization)
- src/trpc/routers/_app.ts (app router with procedures)
- src/trpc/query-client.ts (QueryClient factory)
- src/trpc/client.tsx (client-side provider)
- src/trpc/server.ts (server-side helpers)
- src/app/api/trpc/[trpc]/route.ts (API route handler)
- src/app/layout.tsx (added TRPCReactProvider)
- src/app/page.tsx (RSC prefetching demo)
- src/components/greeting.tsx (client component using tRPC)

### Dependencies added:
- @trpc/server, @trpc/client, @trpc/tanstack-react-query
- @tanstack/react-query
- server-only

### Notes:
- Use `trpc.procedure.prefetch()` in server components for SSR
- Wrap client components with `<HydrateClient>` for hydration
- Use `useTRPC()` hook in client components to get the trpc proxy
- Use `useQuery(trpc.procedure.queryOptions({...}))` pattern for queries
- Context includes db instance for database access in procedures

### Next priority:
Configure Better Auth with Spotify provider (PRD item #9)

---

## 2026-01-08: Better Auth with Spotify Provider Complete

### What was done:
- Installed better-auth package
- Created src/lib/auth.ts with Spotify OAuth provider config
- Configured required Spotify scopes: streaming, user-read-email, user-read-private, playlist-read-private
- Created API route handler at src/app/api/auth/[...all]/route.ts
- Created auth client for frontend at src/lib/auth-client.ts (signIn, signOut, useSession exports)
- Updated database schema to use Better Auth tables (user, session, account, verification)
- Updated game tables to reference Better Auth's user table (text IDs instead of uuid)
- Added relations between Better Auth and game-specific tables
- Verified schema pushes to database successfully

### Files created/modified:
- src/lib/auth.ts (Better Auth server config)
- src/lib/auth-client.ts (Better Auth client)
- src/app/api/auth/[...all]/route.ts (auth API handler)
- src/db/schema.ts (integrated Better Auth tables, updated FK types)

### Dependencies added:
- better-auth

### Notes:
- Use `signIn.social({ provider: "spotify" })` to initiate Spotify login
- Use `useSession()` hook in client components to get session state
- Spotify tokens stored in account table (accessToken, refreshToken, accessTokenExpiresAt)
- Game tables use text IDs for user foreign keys (Better Auth uses text, not uuid)
- Redirect URL for local dev: http://localhost:3000/api/auth/callback/spotify

### Next priority:
Configure test mocking infrastructure (PRD item #4) OR implement Host login with Spotify OAuth (PRD item #10)

---

## 2026-01-08: Spotify OAuth Login/Logout UI Complete

### What was done:
- Created SpotifyLoginButton component with loading state
- Created UserMenu component showing session state and logout
- Updated home page to include UserMenu in CardFooter
- Login button triggers Spotify OAuth flow via Better Auth
- Logout button destroys session via Better Auth
- Session display shows user name/email and profile image

### Files created/modified:
- src/components/spotify-login-button.tsx (new)
- src/components/user-menu.tsx (new)
- src/app/page.tsx (added CardFooter with UserMenu)
- plans/prd.json (marked auth login/logout as passing)

### Notes:
- Uses `signIn.social({ provider: "spotify", callbackURL: "/" })` for login
- Uses `signOut()` for logout
- useSession() hook provides isPending state for loading skeleton
- Session shows user image if available from Spotify profile

### Next priority:
Configure test mocking infrastructure (PRD item #4) OR implement non-host player join flow (PRD item #12)

---

## 2026-01-08: Test Mocking Infrastructure Complete

### What was done:
- Installed msw (Mock Service Worker) 2.x for API mocking
- Created src/mocks/handlers.ts with Spotify API mock handlers
- Created src/mocks/server.ts for Vitest (Node.js) setup
- Created src/mocks/browser.ts for browser environment (Playwright)
- Created src/mocks/db.ts with database mocking utilities (seed functions, mock query builders)
- Created src/mocks/fixtures.ts with comprehensive test fixtures for all entity types
- Created src/mocks/index.ts for convenient re-exports
- Updated vitest.setup.ts to start MSW server for all unit tests
- Created e2e/helpers/mock-api.ts with Playwright route interception helpers
- Added tests to verify mocks work in both Vitest and Playwright
- Fixed outdated e2e/home.spec.ts test assertions

### Files created/modified:
- src/mocks/handlers.ts (Spotify API mocks)
- src/mocks/server.ts (MSW Node server)
- src/mocks/browser.ts (MSW browser worker)
- src/mocks/db.ts (database mocking utilities)
- src/mocks/fixtures.ts (test fixtures)
- src/mocks/index.ts (re-exports)
- src/mocks/__tests__/handlers.test.ts (API mock tests)
- src/mocks/__tests__/db.test.ts (DB mock tests)
- src/mocks/__tests__/fixtures.test.ts (fixture tests)
- vitest.setup.ts (added MSW server lifecycle)
- e2e/helpers/mock-api.ts (Playwright mock helpers)
- e2e/mocks.spec.ts (E2E mock integration tests)
- e2e/home.spec.ts (fixed outdated assertions)

### Dependencies added:
- msw

### Notes:
- Vitest: MSW server auto-starts via vitest.setup.ts, handlers reset between tests
- Playwright: Use helpers from e2e/helpers/mock-api.ts (mockSpotifyApi, mockAuthenticatedUser, etc.)
- Fixtures available for: users, gameSessions, players, turns, timelineSongs, stealAttempts, playerStandings
- DB mocking: Use seedUser(), seedGameSession(), etc. to populate in-memory store
- avatarPresets array has 20+ emoji options for player selection

### Next priority:
Implement non-host players join without authentication (PRD item #12)
